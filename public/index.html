<html>
  <head>
    <!-- vendor css -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <style media="screen">
      body, html {
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>

    <h2>Netbeast developer challenge</h2>
    <h2>There is a MQTT over Websockets (HTTP) server running on port 8000</h2>

    <!-- vendor scripts -->
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script src="/mosca/mqtt.js"></script>

    <script>
      var client = mqtt.connect()

      client.subscribe("mqtt/demo")

      client.on("message", function(topic, payload) {
        toastr.success([topic, payload].join(": "))

        var notification = null;
        if(!('Notification' in window)){
        //Here, we see if the navigator can with hte notifications
        alert('El navegador no soporta las Notificaciones');
         return;
        }else if(Notification.permission === "granted"){
        //If the client accept can received notifications then it is generate the new Notification
        notification = new Notification([topic, payload].join(": "));
       
       }else if(Notification.permission !== 'denied'){
       //If the client hasn't agreed to receive notifications
       //then he will have the option of refusing to accept now.
       Notification.requestPermission(function(permission) {
       if (permission === "granted")
       //We will generate a notification if he accept
       notification = new Notification("Permiso por cliente aceptado" );
                        });
       }
      })

      client.publish("mqtt/demo", "hello world!")
    </script>
  </body>
</html>
