<html>
  <head>
    <!-- vendor css -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <style media="screen">
      body, html {
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>

    <h2>Netbeast developer challenge</h2>
    <h2>There is a MQTT over Websockets (HTTP) server running on port 8000</h2>

    <!-- vendor scripts -->
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <script src="/mosca/mqtt.js"></script>

    <script>
      var client = mqtt.connect()

      client.subscribe("mqtt/demo")

      client.on("message", function(topic, payload) {
	
		
	if (window.Notifications) //compruebo si existe
	  toastr.info([topic, payload].join(": "));
	else if (Notification.permission === "granted") //si existe y tiene permisos
	  var notification = new Notification(topic, { body: payload })
	else if (Notification.permission !== "denied") { //si existe y no tiene permisos

		Notification.requestPermission(function (permission) {  //se pide permiso
					       if (!('permission' in Notification))
					       Notification.permission = permission;

					       if (permission === "granted"){ //si se le da permiso
					       var notification = new Notification(topic, { body: payload })
					       }
					       else{			      //si no se le da permiso
					       toastr.info([topic, payload].join(": "));
					       }
					       
					       });
      }
      else{
	//cuando no se le da permiso (en requestPermission) window.Notifications "deja de existir"
	//sigo mandando las notificaciones con toastr
	toastr.info([topic, payload].join(": "));
      }
    })

      
    </script>
  </body>
</html>
